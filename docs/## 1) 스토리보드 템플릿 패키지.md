## 1) 스토리보드 템플릿 패키지

### 1-1. 공통 JSON 스키마

**Quick(8×3) / Story(15×3) / Trailer(45~60×1)** 모두 같은 틀로 관리하고, `mode`만 바꾸는 구조가 제일 편해.

```json
{
  "mode": "quick|story|trailer",
  "format": "vertical_9_16",
  "stage": "teen|twenties|newlywed|early_parenting",
  "genre": "docu|comedy|drama|melo|fantasy",
  "sliders": { "realism": 0.6, "intensity": 0.4, "pace": 0.7 },
  "clips": [
    {
      "clip_no": 1,
      "role": "hook|main|ending|trailer_scene",
      "duration_sec": 8,
      "scene": {
        "location": "string",
        "time": "string",
        "action": "string",
        "emotion": "string",
        "camera": "string",
        "visual_rules": [
          "no logos", "no famous IP", "no real names", "family faces = silhouette"
        ]
      },
      "caption": "string",
      "title_card": "optional string"
    }
  ]
}
```

---

### 1-2. 장르 프로필 5종(연출 레이어)

이걸 템플릿에 “덧씌우는 레이어”로 쓰면, 템플릿 개수는 적어도 조합이 폭발해.

```json
{
  "docu":  { "camera":"handheld, interview vibe, natural light", "color":"neutral", "music":"minimal", "text":"subtitles, date/location lower-third" },
  "comedy":{ "camera":"snappy cuts, reaction shots", "color":"bright", "music":"bouncy", "text":"punchy captions" },
  "drama": { "camera":"steady, cinematic framing", "color":"warm/soft", "music":"emotional", "text":"short poetic captions" },
  "melo":  { "camera":"close-up emotions, slow push-in", "color":"pastel", "music":"piano/strings", "text":"romantic voiceover style" },
  "fantasy":{ "camera":"wide wonder shots", "color":"dreamy", "music":"ethereal", "text":"mystical titles" }
}
```

---

### 1-3. 스테이지 씬 요소 4종(소품/상황 레이어)

```json
{
  "teen": {
    "anchors": ["classroom", "hallway", "school festival stage", "rainy walk home", "sports day"],
    "props": ["notebook", "test paper", "school bell", "mic", "trophy"],
    "safe_conflict": ["presentation fail", "misunderstanding", "small rivalry", "lost item"]
  },
  "twenties": {
    "anchors": ["interview waiting room", "first office day", "night bus", "tiny studio room", "convenience store"],
    "props": ["resume", "badge", "laptop", "coffee", "late-night street lights"],
    "safe_conflict": ["mistake at work", "deadline", "awkward encounter", "tiny win"]
  },
  "newlywed": {
    "anchors": ["new apartment", "kitchen", "moving boxes", "laundry day", "weekend outing"],
    "props": ["boxes", "dishes", "couple memo", "small gift", "calendar"],
    "safe_conflict": ["housework mismatch", "cooking fail", "budget day", "tiny fight then resolve"],
    "family_rule": "partner face silhouette/blur depth-of-field by default"
  },
  "early_parenting": {
    "anchors": ["dim kitchen at dawn", "living room toys", "stroller walk", "clinic hallway (generic)", "night lullaby"],
    "props": ["bottle", "stroller", "tiny socks", "diaper bag", "sticky notes"],
    "safe_conflict": ["sleepy chaos", "forgotten item", "tiny panic then relief"],
    "family_rule": "baby face not detailed; hands/feet/silhouette"
  }
}
```

---

### 1-4. “바로 쓰는” 템플릿 세트 (MVP 스타터)

아래는 **즉시 사용 가능한** 스타터. (이걸 기반으로 자동 변주해서 60+로 늘리면 됨)

#### A) Quick Pack (8초×3) 템플릿 8개

**Q1 — teen / comedy**

* Hook: 교실 문 열리며 “발표 순서 1번” (심장 쿵) / 캡션: `…하필 오늘?`
* Main: 마이크 잡자마자 목소리 삑사리 + 친구 리액션 컷 / 캡션: `내 목소리 어디 갔어`
* Ending: 본인도 웃음 터짐 → 의외의 박수 / 캡션: `망했는데… 왜 잘 된 느낌?`

**Q2 — teen / docu**

* Hook: 하교길 자막(연도·동네는 가상) / 캡션: `그 시절, 나`
* Main: 운동장/복도 B-roll + 조용한 숨 / 캡션: `그때는 몰랐지`
* Ending: 노트에 “다음엔 더 잘할 거야” / 캡션: `그래도 계속`

**Q3 — twenties / drama**

* Hook: 면접 대기실 손 떨림 / 캡션: `괜찮아… 괜찮아`
* Main: 엘리베이터 거울 속 표정 / 캡션: `첫 시작의 얼굴`
* Ending: 휴대폰에 “합격” 같은 직접 문구 대신 ‘짧은 미소’로 처리 / 캡션: `오늘은 한 칸 전진`

**Q4 — twenties / comedy**

* Hook: 새벽 편의점, 커피 들고 멍 / 캡션: `인생… 왜 이렇게 바빠`
* Main: 노트북 앞 졸음 + 화면 꺼짐 / 캡션: `방금까지 깨어있었는데`
* Ending: 친구 메시지(가상)로 “야 살아있냐” / 캡션: `응. 살아는 있어`

**Q5 — newlywed / comedy**

* Hook: 이사 박스 산더미 / 캡션: `신혼집… 창고였나?`
* Main: 요리 도전 → 연기(과장) / 캡션: `우린 왜 불을 켰지`
* Ending: 둘이 빵 터짐(파트너는 실루엣) / 캡션: `그래도 재밌다`

**Q6 — newlywed / melo**

* Hook: 주말 아침 창가 빛 / 캡션: `조용한 시작`
* Main: 작은 메모(가상) “고마워” / 캡션: `말보다 먼저`
* Ending: 손 잡는 컷 / 캡션: `오늘도 같이`

**Q7 — early_parenting / comedy**

* Hook: 새벽 알람 + 부엌 불빛 / 캡션: `새벽 3시… 또`
* Main: 기저귀 가방 찾느라 패닉(코믹) / 캡션: `내가 어디 뒀더라`
* Ending: 작은 발(디테일 X) + 안도 / 캡션: `아… 다행이다`

**Q8 — early_parenting / drama**

* Hook: 조용한 밤, 흔들리는 그림자 / 캡션: `나만 깨어있던 시간`
* Main: 물컵/젖병/메모지 / 캡션: `버티는 게 사랑`
* Ending: 아침 햇살 / 캡션: `다시 시작`

---

#### B) Story Pack (15초×3) 템플릿 6개 (각 클립 “비트 3개”)

각 클립은 **(비트1) 상황 → (비트2) 감정/갈등 → (비트3) 전환** 구조.

**S1 — teen / drama**

* Clip1(Hook, 15s): 종-복도-교실(상황) → 발표 공지(갈등) → 숨 고르기(전환) / 캡션: `오늘만은…`
* Clip2(Main, 15s): 무대 준비(상황) → 실수(갈등) → 친구의 작은 도움(전환) / 캡션: `혼자 아니었어`
* Clip3(Ending, 15s): 조용한 하교(상황) → 복기(갈등) → “다음엔 더” 다짐(전환) / 캡션: `계속 간다`

**S2 — twenties / comedy**

* Clip1: 출근 준비(상황) → 셔츠/가방/지하철 허둥(갈등) → “그래도 가자”(전환)
* Clip2: 회의 직전(상황) → 자료 날림(갈등) → 임기응변 성공(전환)
* Clip3: 밤버스(상황) → 피로 폭발(갈등) → 편의점 아이스크림으로 회복(전환)

**S3 — newlywed / melo**

* Clip1: 이사 정리(상황) → 작은 다툼(갈등) → “미안” 메모(전환)
* Clip2: 저녁 식사(상황) → 서로 피곤(갈등) → 같이 설거지(전환)
* Clip3: 산책(상황) → 말 없는 시간(갈등) → 손 잡고 웃음(전환)

**S4 — early_parenting / drama**

* Clip1: 새벽(상황) → 체력 바닥(갈등) → 물 한 잔/숨 고르기(전환)
* Clip2: 낮 외출(상황) → 준비물 누락(갈등) → 웃으며 해결(전환)
* Clip3: 밤(상황) → 불안(갈등) → 아침 빛(전환)

**S5 — teen / fantasy**

* Clip1: 복도 끝 문(상황) → 이상한 빛(갈등) → 문이 열림(전환)
* Clip2: 숨겨진 “동아리방”(상황) → 시험지 변함(갈등) → 용기 선택(전환)
* Clip3: 현실로(상황) → 미소(갈등) → “내가 바뀌었다”(전환)

**S6 — newlywed / comedy**

* Clip1: 장보기(상황) → 예산 초과(갈등) → 눈치게임(전환)
* Clip2: 요리(상황) → 대참사(갈등) → 배달로 타협(전환)
* Clip3: 거실(상황) → 웃음(갈등) → “우리 팀플 잘한다”(전환)

---

#### C) Trailer (45~60초×1) 템플릿 3개

**T1 — teen / docu (60s)**

1. 타이틀카드: `기록: 어느 평범한 날`
2. 교실 B-roll + 낮은 자막(가상 시간/장소)
3. 발표 공지(전환점1)
4. 연습하는 손/노트(감정)
5. 작은 실수(갈등)
6. 숨 고르기(회복)
7. 하교길(여운)
8. 엔딩카드: `Fiction/Simulation`

**T2 — twenties / drama (60s)**

1. 타이틀: `첫 시작의 계절`
2. 면접 대기 → 출근 엘리베이터
3. 실수(전환점)
4. 밤거리/야근
5. 작은 성취(가상의 상징)
6. 웃는 장면
7. 다음 선택(여운)
8. 엔딩

**T3 — early_parenting / comedy (45s)**

1. 타이틀: `육아는… 장르가 코미디`
2. 새벽 알람
3. 준비물 찾기 패닉
4. 유모차 외출 해프닝
5. 잠깐의 평화(커피 한 모금)
6. 또 시작(반복 개그)
7. 힐링 엔딩(햇살)

> 템플릿 확장 방법:
> “스테이지 앵커(장소/소품)” + “장르 프로필(카메라/색/텍스트)”을 조합해 자동으로 변주하면, **Quick 60+ / Story 60+ / Trailer 20+**는 금방 늘릴 수 있어.

---

## 2) Rewrite Moment 정제 규칙 + 프롬프트 세트

### 2-1. 정제(마스킹) 규칙

* **개인정보 패턴 제거**

  * 전화: `\b01[016789]-?\d{3,4}-?\d{4}\b`
  * 이메일: `\b[\w\.-]+@[\w\.-]+\.\w+\b`
  * 계좌/주민/주소처럼 보이는 패턴: 숫자/지번/동-호 조합 감지 시 제거
* **실명/학교/회사/지명**: 사용자 입력 그대로 쓰지 않고 “익명/가상”으로 치환
* **IP 필터**: 작품명/캐릭터명/브랜드/로고 언급 감지 시 “장르 키워드”로 치환

### 2-2. Rewrite Sanitizer 프롬프트(텍스트→안전한 사건 요약)

요청/응답을 JSON으로 강제.

**SYSTEM(요약):**

* “직접 재현” 금지, 실명/고유명사/정확한 날짜 제거
* 핵심은 “감정/갈등/원하는 결말”만 남김
* 민감/폭력/자해는 구체 묘사 금지, 상징화

**USER 입력:**

* raw_text, distance_mode, desired_ending, stage, genre

**ASSISTANT 출력(JSON):**

```json
{
  "sanitized_event": "가상화된 한 줄 사건",
  "core_emotion": ["shame|regret|anger|fear|sadness|relief|hope"],
  "metaphor_scene": "유사 상황(상징화) 설명",
  "do_not_include": ["real names", "exact locations", "graphic violence", "self-harm methods"],
  "rewrite_goal": "사용자가 고른 결말을 달성하는 방향"
}
```

### 2-3. Rewrite 적용 프롬프트(Clip3/장면 교체용)

* 입력: `metaphor_scene + rewrite_goal + genre_profile + stage anchors`
* 출력: Clip3(또는 Trailer 중간 장면) 스펙(장소/행동/전환/캡션)

---

## 3) 화면별 마이크로카피(결제 전환 포함)

### Screen 1 업로드

* 제목: `내 사진으로 ‘내가 주인공인 영화’를 만들어봐`
* 안내: `정면/밝은 사진 1~3장이 가장 잘 나와요.`
* 체크: `결과물은 가상의 창작물(Fiction/Simulation)이며 예측/사실이 아닙니다.`
* 버튼: `다음`

### Screen 2 선택

* 섹션: `스테이지 선택` / `장르 선택` / `길이 선택`
* 길이 라벨:

  * `무료 Quick (8초×3)`
  * `유료 Story (15초×3) — 더 영화처럼`
  * `유료 Trailer (45~60초) — 예고편 완성`
* 슬라이더 설명:

  * 현실감: `현실적일수록 담백, 영화적일수록 연출 강화`
  * 강도: `순한맛(안전) ↔ 진한맛(드라마틱)`
  * 속도: `컷 편집 템포`
* CTA(무료 사용자가 고른 후):

  * `더 길게(15초/트레일러) 만들면 전환·반전이 더 살아나요`

### Screen 3 Rewrite Moment(선택)

* 제목: `Rewrite Moment(선택): 잊지 못하는 순간을 다른 결말로`
* 안내: `실명/학교/회사/주소는 적지 말아주세요. 유사 상황으로 재구성됩니다.`
* 거리두기 설명: `상징적으로 → 더 안전 / 꽤 비슷하게 → 더 몰입`
* 결말 선택 설명: `원하는 방향으로 엔딩을 바꿔요`

### Screen 4 결과

* 탭: `클립 1 / 클립 2 / 클립 3(엔딩)`
* 버튼: `다운로드` / `공유 링크 만들기`
* 무료 업셀:

  * `15초로 업그레이드하면 “상황→감정→전환”이 들어갑니다`
  * `트레일러로 만들면 예고편처럼 이어집니다`
* 재생성 버튼:

  * `이 클립만 다시 만들기`
  * `Rewrite 엔딩만 다시 만들기`

### 결제(크레딧) 카피

* `Story: 2 크레딧 / Trailer: 5 크레딧 / Rewrite: +1 크레딧`
* `재생성은 클립/장면 단위로만 크레딧이 소모돼요.`

---

## 4) DB 스키마 + 잡큐/재생성 정책(에러 케이스 포함)

### 4-1. 테이블(핵심)

* `users(id, email, created_at)`
* `credit_ledger(id, user_id, delta, reason, ref_job_id, created_at)`  ← 크레딧 장부(중요)
* `jobs(id, user_id, mode, stage, genre, sliders_json, rewrite_enabled, status, created_at)`
* `rewrite_inputs(job_id, raw_text, sanitized_text, distance_mode, desired_ending)`
* `identity_packs(id, job_id, stage, ref_asset_ids_json)`
* `assets(id, job_id, type(image|video|thumb|zip), url, metadata_json, created_at)`
* `shares(id, job_id, token, created_at, views)`

### 4-2. 잡 상태

* `queued → running → (partial_done) → done`
* 실패는 단계별로:

  * `failed_identity`
  * `failed_storyboard`
  * `failed_image`
  * `failed_video`
  * `failed_postprocess`

### 4-3. 재생성 정책

* Quick(무료): 재생성 0회(또는 하루 1회만)
* Story/Trailer(유료):

  * Story: **클립 단위 재생성**
  * Trailer: **장면 단위 재생성**
* 재생성 시 크레딧 차감은 `credit_ledger`로 **idempotent**하게(중복 차감 방지 키: `job_id+asset_id+attempt_no`)

### 4-4. 무료 제한(레이트리밋)

* Free Quick: `1 pack/day` (권장)
* 동일 기기/계정/아이피 남용 방지: `rate_limit_key = user_id + ip_hash`

### 4-5. 자동 검수(실패/재시도)

* 얼굴 붕괴/텍스트 깨짐/금칙어 노출 등 감지 시:

  * 해당 클립(또는 장면)만 **최대 2회 재시도**
  * 2회 실패면 “대체 템플릿”으로 fallback

