<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²°ê³¼ - Rewrite Moment</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¬</text></svg>">
</head>
<body>
  <div class="bg-pattern"></div>
  <div class="noise-overlay"></div>

  <!-- Navigation -->
  <nav class="nav">
    <div class="container nav-inner">
      <a href="index.html" class="nav-logo">
        <div class="nav-logo-icon">ğŸ¬</div>
        <span class="nav-logo-text">Rewrite Moment</span>
      </a>
      <ul class="nav-links">
        <li><a href="index.html#features" class="nav-link">ê¸°ëŠ¥</a></li>
        <li><a href="index.html#how" class="nav-link">ì´ìš©ë°©ë²•</a></li>
        <li><a href="pricing.html" class="nav-link">ê°€ê²©</a></li>
      </ul>
      <div class="nav-auth">
        <div class="nav-credits">
          <span class="nav-credits-icon">ğŸ’</span>
          <span class="nav-credits-value" id="nav-credits">0</span>
          <span style="color: var(--text-muted)">í¬ë ˆë”§</span>
        </div>
        <button class="btn-login" id="btn-open-login" onclick="openAuthModal('login')">ë¡œê·¸ì¸</button>
        <div class="user-menu hidden" id="user-menu">
          <div class="user-avatar" id="user-avatar" onclick="toggleUserDropdown()">U</div>
          <div class="user-dropdown" id="user-dropdown">
            <div class="user-dropdown-header">
              <div class="user-dropdown-name" id="user-name">ì‚¬ìš©ì</div>
              <div class="user-dropdown-email" id="user-email">user@email.com</div>
            </div>
            <div class="user-dropdown-menu">
              <a href="pricing.html" class="user-dropdown-item">ğŸ’ í¬ë ˆë”§ ì¶©ì „</a>
              <a href="#" class="user-dropdown-item">ğŸ“‹ ë‚´ ì˜ìƒ</a>
              <div class="user-dropdown-item logout" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="page" style="padding-top: 100px;">
    <div class="container">
      
      <!-- Progress Steps -->
      <div class="steps">
        <div class="step completed">
          <div class="step-number">âœ“</div>
          <span class="step-text">ì—…ë¡œë“œ</span>
        </div>
        <div class="step-line completed"></div>
        <div class="step completed">
          <div class="step-number">âœ“</div>
          <span class="step-text">ì„ íƒ</span>
        </div>
        <div class="step-line completed"></div>
        <div class="step completed">
          <div class="step-number">âœ“</div>
          <span class="step-text">ìƒì„±</span>
        </div>
        <div class="step-line completed"></div>
        <div class="step active">
          <div class="step-number">4</div>
          <span class="step-text">ê²°ê³¼</span>
        </div>
      </div>

      <!-- Page Header -->
      <div class="page-header" data-animate>
        <h1 class="page-title">
          ğŸ‰ <span class="text-gradient">ì˜ìƒì´ ì™„ì„±</span>ë˜ì—ˆì–´ìš”!
        </h1>
        <p class="page-subtitle" id="pageSubtitle">
          ì–´ë²¤ì €ìŠ¤ ì´¬ì˜ì¥ì—ì„œì˜ ì…€ì¹´
        </p>
      </div>

      <!-- Result Layout -->
      <div class="result-layout">
        
        <!-- Video Section -->
        <div class="result-video-section" data-animate style="animation-delay: 0.1s">
          <!-- Video Player -->
          <div class="video-player-wrapper">
            <div class="video-container" id="videoContainer">
              <div class="video-placeholder" id="videoPlaceholder">
                <div class="video-placeholder-icon">ğŸ¬</div>
                <p>ì˜ìƒ ë¡œë”© ì¤‘...</p>
                <span class="video-duration">8ì´ˆ</span>
              </div>
              <video id="videoPlayer" controls playsinline style="display: none; width: 100%; height: 100%; object-fit: contain; border-radius: var(--radius-xl);"></video>
            </div>

            <!-- Video Info -->
            <div class="video-info">
              <div class="video-caption" id="videoCaption">
                "ë‚˜ì˜ íŠ¹ë³„í•œ ìˆœê°„"
              </div>
              <div class="video-meta" id="videoMeta">
                <span>ğŸ¦¸ ì–´ë²¤ì €ìŠ¤</span>
                <span>ğŸ“¸ ì…€ì¹´</span>
                <span>â±ï¸ 8ì´ˆ</span>
              </div>
            </div>
          </div>

          <!-- Video Actions -->
          <div class="video-actions">
            <button class="btn btn-primary" id="playBtn" onclick="togglePlay()">
              <span id="playIcon">â–¶</span>
              <span id="playText">ì¬ìƒí•˜ê¸°</span>
            </button>
          </div>
        </div>

        <!-- Info Section -->
        <div class="result-info-section">
          
          <!-- Download & Share -->
          <div class="card result-card" data-animate style="animation-delay: 0.2s">
            <h3 class="result-card-title">ë‹¤ìš´ë¡œë“œ & ê³µìœ </h3>
            <div class="result-card-actions">
              <button class="btn btn-primary w-full" id="downloadBtn" onclick="downloadVideo()">
                <span>â¬‡ï¸</span>
                ì˜ìƒ ë‹¤ìš´ë¡œë“œ
              </button>
              <button class="btn btn-secondary w-full" id="shareBtn">
                <span>ğŸ”—</span>
                ê³µìœ í•˜ê¸°
              </button>
            </div>
          </div>

          <!-- Regenerate -->
          <div class="card result-card" data-animate style="animation-delay: 0.3s">
            <h3 class="result-card-title">ë‹¤ë¥¸ ì˜í™”ë¡œ ë‹¤ì‹œ ë§Œë“¤ê¸°</h3>
            <p class="result-card-desc">ë‹¤ë¥¸ ì˜í™” ì´¬ì˜ì¥ì—ì„œ ì…€ì¹´ë¥¼ ì°ì–´ë³´ì„¸ìš”!</p>
            <a href="select.html" class="btn btn-secondary w-full">
              <span>ğŸ¬</span> ë‹¤ë¥¸ ì˜í™” ì„ íƒí•˜ê¸°
            </a>
          </div>

          <!-- Movie Info Card -->
          <div class="card result-card movie-info-result" data-animate style="animation-delay: 0.4s" id="movieInfoCard">
            <div class="movie-result-header">
              <span class="movie-result-icon" id="movieResultIcon">ğŸ¦¸</span>
              <div>
                <h3 class="movie-result-title" id="movieResultTitle">ì–´ë²¤ì €ìŠ¤</h3>
                <p class="movie-result-actors" id="movieResultActors">ì•„ì´ì–¸ë§¨, ìº¡í‹´, í† ë¥´, ë¸”ë™ìœ„ë„ìš°</p>
            </div>
            </div>
          </div>

        </div>
      </div>

      <!-- New Creation CTA -->
      <div class="new-creation-cta mt-2xl" data-animate style="animation-delay: 0.5s">
        <a href="upload.html" class="btn btn-secondary btn-lg">
          <span>âœ¨</span>
          ìƒˆë¡œìš´ ì˜ìƒ ë§Œë“¤ê¸°
        </a>
      </div>

      <!-- Disclaimer -->
      <div class="disclaimer mt-xl" data-animate style="animation-delay: 0.6s">
        <strong>Fiction / Simulation</strong> - ì´ ê²°ê³¼ë¬¼ì€ AIê°€ ìƒì„±í•œ ê°€ìƒì˜ ì°½ì‘ë¬¼ì´ë©°, ì‹¤ì œ ì˜í™”ë‚˜ ë°°ìš°ì™€ëŠ” ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤.
      </div>

    </div>
  </main>

  <!-- Share Modal -->
  <div class="modal-overlay" id="shareModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ê³µìœ  ë§í¬</h3>
        <button class="modal-close" onclick="closeShareModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px; color: var(--text-secondary);">
          ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”
        </p>
        <div class="share-link-box">
          <input type="text" class="form-input" id="shareLink" value="https://cliplife.app/s/abc123xyz" readonly>
          <button class="btn btn-primary" id="copyLinkBtn">ë³µì‚¬</button>
        </div>
        <div class="share-buttons mt-lg">
          <button class="btn btn-secondary share-social-btn">
            <span>ğŸ“±</span> ì¹´ì¹´ì˜¤í†¡
          </button>
          <button class="btn btn-secondary share-social-btn">
            <span>ğŸ¦</span> íŠ¸ìœ„í„°
          </button>
          <button class="btn btn-secondary share-social-btn">
            <span>ğŸ“·</span> ì¸ìŠ¤íƒ€
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast toast-success" id="toast">
    <span>âœ“</span>
    <span id="toastMessage">ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”!</span>
  </div>

  <script src="/js/app.js"></script>
  <style>
    /* Result Page Specific Styles */
    .result-layout {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 40px;
      align-items: start;
    }

    .result-video-section {
      position: sticky;
      top: 100px;
    }

    .video-player-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .video-container {
      width: 100%;
      max-width: 720px;
      aspect-ratio: 16/9;
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 40px var(--accent-glow);
      border: 2px solid rgba(240, 180, 41, 0.2);
    }

    .video-placeholder {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #2a1a3a 0%, #1a1025 100%);
      color: var(--text-secondary);
    }

    .video-placeholder-icon {
      font-size: 4rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .video-duration {
      margin-top: 8px;
      padding: 4px 12px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
    }

    .video-info {
      margin-top: 20px;
      text-align: center;
    }

    .video-caption {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--accent-tertiary);
    }

    .video-meta {
      display: flex;
      gap: 16px;
      justify-content: center;
      font-size: 0.85rem;
      color: var(--text-tertiary);
    }

    .video-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 24px;
    }

    /* Result Cards */
    .result-card {
      margin-bottom: 20px;
    }

    .result-card-title {
      font-size: 1.125rem;
      margin-bottom: 12px;
    }

    .result-card-desc {
      font-size: 0.9rem;
      color: var(--text-tertiary);
      margin-bottom: 16px;
    }

    .result-card-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Movie Info Result Card */
    .movie-info-result {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
      border: 1px solid rgba(168, 85, 247, 0.2);
    }

    .movie-result-header {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .movie-result-icon {
      font-size: 2.5rem;
    }

    .movie-result-title {
      font-size: 1.25rem;
      margin: 0 0 4px 0;
    }

    .movie-result-actors {
      font-size: 0.85rem;
      color: var(--text-tertiary);
      margin: 0;
    }

    /* Share Modal */
    .share-link-box {
      display: flex;
      gap: 12px;
    }

    .share-link-box input {
      flex: 1;
    }

    .share-buttons {
      display: flex;
      gap: 12px;
    }

    .share-social-btn {
      flex: 1;
    }

    /* New Creation CTA */
    .new-creation-cta {
      text-align: center;
    }

    @media (max-width: 1024px) {
      .result-layout {
        grid-template-columns: 1fr;
      }

      .result-video-section {
        position: static;
      }
    }

    @media (max-width: 768px) {
      .video-container {
        max-width: 280px;
      }

      .share-buttons {
        flex-direction: column;
      }
    }
  </style>
  <script>
    // ì˜í™” ì •ë³´ ë§¤í•‘
    const movieInfo = {
      avengers: { icon: 'ğŸ¦¸', title: 'ì–´ë²¤ì €ìŠ¤', actors: 'ì•„ì´ì–¸ë§¨, ìº¡í‹´ ì•„ë©”ë¦¬ì¹´, í† ë¥´, ë¸”ë™ìœ„ë„ìš°' },
      spiderman: { icon: 'ğŸ•·ï¸', title: 'ìŠ¤íŒŒì´ë”ë§¨', actors: 'í”¼í„° íŒŒì»¤, MJ, ë„¤ë“œ' },
      harrypotter: { icon: 'âš¡', title: 'í•´ë¦¬í¬í„°', actors: 'í•´ë¦¬, í—¤ë¥´ë¯¸ì˜¨ëŠ, ë¡ ' },
      lotr: { icon: 'ğŸ’', title: 'ë°˜ì§€ì˜ ì œì™•', actors: 'í”„ë¡œë„, ê°„ë‹¬í”„, ì•„ë¼ê³¤, ë ˆê³¨ë¼ìŠ¤' },
      starwars: { icon: 'âš”ï¸', title: 'ìŠ¤íƒ€ì›Œì¦ˆ', actors: 'ë£¨í¬, ë ˆì•„, í•œ ì†”ë¡œ' },
      jurassic: { icon: 'ğŸ¦–', title: 'ì¥¬ë¼ê¸° ê³µì›', actors: 'ê·¸ëœíŠ¸ ë°•ì‚¬, ì—˜ë¦¬, ë§ì½¤ ë°•ì‚¬' },
    };

    // Result page functionality
    const videoCaption = document.getElementById('videoCaption');
    const shareModal = document.getElementById('shareModal');
    const toast = document.getElementById('toast');
    const videoPlayer = document.getElementById('videoPlayer');
    const videoPlaceholder = document.getElementById('videoPlaceholder');
    const videoContainer = document.getElementById('videoContainer');
    const videoMeta = document.getElementById('videoMeta');

    // IndexedDB í—¬í¼ í•¨ìˆ˜
    function openVideoDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('ClipLifeVideoDB', 1);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          if (!db.objectStoreNames.contains('videos')) {
            db.createObjectStore('videos', { keyPath: 'id' });
          }
    };
      });
    }

    async function getVideoFromIndexedDB() {
      const db = await openVideoDB();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(['videos'], 'readonly');
        const store = transaction.objectStore('videos');
        const request = store.get('generatedVideo');
        request.onsuccess = () => {
          console.log('IndexedDB result:', request.result);
          resolve(request.result?.data || null);
        };
        request.onerror = () => reject(request.error);
      });
    }

    // ì €ì¥ëœ ì„¤ì • ë¡œë“œ
    const aspectRatio = sessionStorage.getItem('selectedRatio') || '16:9';
    const selectedMovie = sessionStorage.getItem('selectedMovie') || 'avengers';
    const movie = movieInfo[selectedMovie] || movieInfo.avengers;

    // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
    document.getElementById('pageSubtitle').textContent = `${movie.title} ì´¬ì˜ì¥ì—ì„œì˜ ì…€ì¹´ Â· ${aspectRatio}`;
    document.getElementById('videoCaption').textContent = `"${movie.title} ì´¬ì˜ì¥ì—ì„œ"`;
    document.getElementById('movieResultIcon').textContent = movie.icon;
    document.getElementById('movieResultTitle').textContent = movie.title;
    document.getElementById('movieResultActors').textContent = movie.actors;

    // ë¹„ë””ì˜¤ ë©”íƒ€ ì—…ë°ì´íŠ¸
    if (videoMeta) {
      videoMeta.innerHTML = `
        <span>${movie.icon} ${movie.title}</span>
        <span>ğŸ“¸ ì…€ì¹´</span>
        <span>â±ï¸ 8ì´ˆ</span>
      `;
    }

    // ë¹„ìœ¨ì— ë”°ë¥¸ ë¹„ë””ì˜¤ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì¡°ì •
    if (aspectRatio === '9:16') {
      videoContainer.style.aspectRatio = '9/16';
      videoContainer.style.maxWidth = '350px';
      videoContainer.style.margin = '0 auto';
    } else {
      videoContainer.style.aspectRatio = '16/9';
      videoContainer.style.maxWidth = '100%';
    }

    // ì˜ìƒ ë¡œë“œ (IndexedDBì—ì„œ)
    async function loadVideo() {
      console.log('Loading video from IndexedDB...');
      try {
        const videoData = await getVideoFromIndexedDB();
        console.log('Video data received:', videoData ? `${videoData.length} chars` : 'null');
        
        if (videoData) {
          videoPlayer.src = videoData;
          videoPlayer.style.display = 'block';
          videoPlaceholder.style.display = 'none';
          console.log('Video loaded successfully');
        } else {
          console.log('No video data found');
          videoPlayer.style.display = 'none';
          videoPlaceholder.style.display = 'flex';
          videoPlaceholder.querySelector('p').textContent = 'ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤';
        }
      } catch (error) {
        console.error('ì˜ìƒ ë¡œë“œ ì˜¤ë¥˜:', error);
        videoPlayer.style.display = 'none';
        videoPlaceholder.style.display = 'flex';
        videoPlaceholder.querySelector('p').textContent = 'ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨';
      }
    }
    
    // ì˜ìƒ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    async function downloadVideo() {
      try {
        const videoData = await getVideoFromIndexedDB();
        if (!videoData) {
          alert('ë‹¤ìš´ë¡œë“œí•  ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        // Base64ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
        const response = await fetch(videoData);
        const blob = await response.blob();
        
        // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${movie.title}_ì…€ì¹´_${Date.now()}.mp4`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast('ì˜ìƒì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (error) {
        console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì¬ìƒ/ì •ì§€ í† ê¸€
    function togglePlay() {
      const playIcon = document.getElementById('playIcon');
      const playText = document.getElementById('playText');
      
      if (videoPlayer.paused) {
        videoPlayer.play();
        playIcon.textContent = 'â¸';
        playText.textContent = 'ì¼ì‹œì •ì§€';
      } else {
        videoPlayer.pause();
        playIcon.textContent = 'â–¶';
        playText.textContent = 'ì¬ìƒí•˜ê¸°';
      }
    }

    // í† ìŠ¤íŠ¸ í‘œì‹œ
    function showToast(message) {
      const toastEl = document.getElementById('toast');
      const toastMsg = document.getElementById('toastMessage');
      toastMsg.textContent = message;
      toastEl.classList.add('show');
      setTimeout(() => toastEl.classList.remove('show'), 3000);
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜ìƒ ë¡œë“œ
    loadVideo();

    // ë¹„ë””ì˜¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    videoPlayer.addEventListener('play', () => {
      document.getElementById('playIcon').textContent = 'â¸';
      document.getElementById('playText').textContent = 'ì¼ì‹œì •ì§€';
    });
    
    videoPlayer.addEventListener('pause', () => {
      document.getElementById('playIcon').textContent = 'â–¶';
      document.getElementById('playText').textContent = 'ì¬ìƒí•˜ê¸°';
    });

    videoPlayer.addEventListener('ended', () => {
      document.getElementById('playIcon').textContent = 'â–¶';
      document.getElementById('playText').textContent = 'ì¬ìƒí•˜ê¸°';
    });

    // Share modal
    document.getElementById('shareBtn').addEventListener('click', () => {
      shareModal.classList.add('show');
    });

    function closeShareModal() {
      shareModal.classList.remove('show');
    }

    shareModal.addEventListener('click', (e) => {
      if (e.target === shareModal) {
        closeShareModal();
      }
    });

    // Copy link
    document.getElementById('copyLinkBtn').addEventListener('click', () => {
      const input = document.getElementById('shareLink');
      input.select();
      document.execCommand('copy');
      showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”!');
    });
  </script>
</body>
</html>
